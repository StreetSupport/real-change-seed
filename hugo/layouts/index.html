{{ define "main" }}
{{ partial "header.html" .Params.header }}
<div class="home-hero">
{{ partial "hero.html" .Params.hero }}
</div>

<div id="main">

  <section class="section home-intro">
    <div class="container">
      <div class="boxed home-intro-whatis">
        <div class="boxed-inner">
          <h2>{{ .Params.whatis.heading }}</h2>
          {{ $whatisBodyMarkdown := .Params.whatis.body | markdownify }}
          {{ if not ( strings.Contains $whatisBodyMarkdown "<p>" ) }}<p>{{ $whatisBodyMarkdown }}</p>{{ else }}{{ $whatisBodyMarkdown }}{{ end }}
          {{ if .Params.whatis.button.url }}<a class="button button-primary d-block" href="{{ .Params.whatis.button.url }}">{{ .Params.whatis.button.text }}</a>{{ end }}
        </div>
        {{ if .Params.whatis.image }}
        <div class="boxed-media aspect aspect-1by1">
          <img alt="" class="aspect-item" src="{{ .Params.whatis.image }}">
        </div>
        {{ end }}
      </div>
      <div class="home-intro-split">
        <div class="boxed home-intro-who">
          <div class="boxed-inner">
            <h2>{{ .Params.who.heading }}</h2>
            {{ $whoBodyMarkdown := .Params.who.body | markdownify }}
            {{ if not ( strings.Contains $whoBodyMarkdown "<p>" ) }}<p>{{ $whoBodyMarkdown }}</p>{{ else }}{{ $whoBodyMarkdown }}{{ end }}
          </div>
        </div>
        <div class="boxed home-intro-apply">
          <div class="boxed-inner">
            <h2>{{ .Params.how.heading }}</h2>
            {{ $howBodyMarkdown := .Params.how.body | markdownify }}
            {{ if not ( strings.Contains $howBodyMarkdown "<p>" ) }}<p>{{ $howBodyMarkdown }}</p>{{ else }}{{ $howBodyMarkdown }}{{ end }}
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section bg-rh-grey-light home-partners">
    <div class="container">
      <div class="home-partners-header">
        <h2 class="h1 home-partners-title">{{ .Params.partners.heading }}</h2>
      </div>
      {{ if .Params.partners.youtube }}
      <div class="home-partners-media">
        <div class="aspect aspect-2by1">
          <iframe src="{{ .Params.partners.youtube }}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      </div>
      {{ end }}
      {{ if .Params.partners.image }}
      <div class="home-partners-media">
        <div class="aspect aspect-3by1">
          <img alt="" src="{{ .Params.partners.image }}">
        </div>
      </div>
      {{ end }}
      <div class="home-partners-body">
        {{ $partnersBodyMarkdown := .Params.partners.body | markdownify }}
        {{ if not ( strings.Contains $partnersBodyMarkdown "<p>" ) }}<p>{{ $partnersBodyMarkdown }}</p>{{ else }}{{ $partnersBodyMarkdown }}{{ end }}
        {{ .Params.partners.list | markdownify | replaceRE "<ul>" "<ul class=\"list-flex font-weight-bold\">" | safeHTML }}
      </div>
    </div>
  </section>

  {{ with .Site.GetPage "section" "stories" }}{{ if eq .Params.showonhome true }}
  <section class="section">
    <div class="home-stories">
      <div class="container">
        <div class="home-stories-header">
          <h2 class="h1 home-stories-title">
            {{ with .Site.GetPage "section" "stories" }}{{ .Params.heading }}{{ end }}
          </h2>
        </div>
        <div class="home-stories-body">
          {{ range first 4 (where .Site.RegularPages.ByDate.Reverse "Section" "stories") }}
            <div class="card-story">
              <h3 class="card-story-title">{{ .Params.snippet.heading }}</h3>
                <div class="card-story-image aspect aspect-5by2">
                  <img alt="" src="/{{ .Params.snippet.image }}">
                </div>
              <a class="card-story-cta" href="{{ .Permalink }}">{{ .Params.snippet.text }}</a>
            </div>
          {{ end }}
        </div>
        <div class="home-stories-footer text-center">
          {{ with .Site.GetPage "section" "stories" }}<a class="button" href="{{ .Params.button.url }}">{{ .Params.button.text }}</a>{{ end }}
        </div>
      </div>
    </div>
  </section>
  {{ end }}{{ end }}

</div>

{{ $footer := .Site.GetPage "_footer.md" }}
{{ partial "footer.html" (dict "footer" $footer) }}
<script>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (!user) {
        window.netlifyIdentity.on("login", () => {
          document.location.href = "/admin/";
        });
      }
    });
  }
</script>
{{ end }}